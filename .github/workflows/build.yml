name: Build EXE

# 触发条件：当你 push 代码到 main 分支时自动触发
on:
  push:
    branches: [ "main", "master" ]
  workflow_dispatch: # 允许你在 Actions 页面手动点击按钮触发

jobs:
  build:
    runs-on: windows-latest

    steps:
    # 1. 拉取代码
    - uses: actions/checkout@v4

    # 2. 设置 Python 环境 (这里选 3.10 很稳定)
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'

    # 3. 安装依赖 (核心步骤)
    # 我们直接在这里安装 customtkinter 和 pyinstaller，确保它们在同一个环境里
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install customtkinter pyinstaller
        # 如果你有其他依赖，也可以在这里加，或者 pip install -r requirements.txt

    # 4. 执行打包 (核弹级命令)
    # --collect-all customtkinter: 强制抓取所有样式文件
    - name: Build with PyInstaller
      run: |
        pyinstaller --noconfirm --onefile --windowed --collect-all customtkinter main.py

    # 5. 上传打包结果
    # 打包好的 exe 会出现在 Actions 的 Summary 页面供你下载
    - name: Upload EXE Artifact
      uses: actions/upload-artifact@v4
      with:
        name: AutoDeployTool
        path: dist/main.exe
        retention-days: 5
